<p>Submit team deliverables and individual deliverables separately. Any person on the team can submit your team
  deliverables.</p>
<p>If your deliverable contains more than one file, then create a zip file.</p>
<% courses = @deliverable.creator.registered_for_these_courses_during_current_semester.delete_if {|course| course.assignments.empty?} %>

<%= form_for @deliverable, :html => {:multipart => true} do |f| %>
    <%= render 'shared/error_messages', object: f.object %>

    <table class='layout_table'>
      <tbody>
        <tr>
          <td><%= f.label :course_id, "Select Course" %></td>
          <td><%= f.collection_select(:course_id, courses, :id, :name, {:include_blank => true}, {:name => "course_id"}) %></td>
        </tr>
        <tr>
          <td><%= f.label :assignment_id, "Select Assignment" %></td>
          <td><%= f.collection_select(:assignment_id, [], :id, :name, :include_blank => true) %></td>
        </tr>
      </tbody>
    </table>

    <div class="deliverable_attachment">
      <%= fields_for :deliverable_attachment do |attachment_form| -%>
        <p>
          <%= attachment_form.label :attachment, "Deliverable file to upload" %>
          <%= attachment_form.file_field :attachment %>
        </p>

        <p>
          <%= attachment_form.label :comment, "Comments" %>
          <br>
          <%= attachment_form.text_area :comment, :size => "90x10" %>
        </p>
      <% end -%>
    </div>

    <p>
      <%= f.submit button_name %>
    </p>
<% end %>

<%
   assignment_options = ''
   courses.each do |course|
     assignment_options += "'#{course.id}':\""
     course.submittable_assignments.each do |assignment|
       assignment_options += "<option value='#{assignment.id}'>" +
               "Task #{assignment.task_number}: #{assignment.title} " +
               (assignment.team_deliverable ? "(Team deliverable)" : "") +
               "</option>";
     end
     assignment_options += "\","
   end
%>

<%= javascript_tag do %>
  $(function() {
    assignment_options = {<%= assignment_options.html_safe %>};

    if ($('#deliverable_course_id').val()) {
      $('#deliverable_assignment_id').html(assignment_options[$('#deliverable_course_id').val()]);
      <% if !@deliverable.assignment.nil? %>
        $('#deliverable_assignment_id').val('<%= @deliverable.assignment.id %>');
      <% end %>
    }

    $('#deliverable_course_id').change(function() {
      if ($('#deliverable_course_id').val()) {
        $('#deliverable_assignment_id').html(assignment_options[$('#deliverable_course_id').val()]);
      } else {
        $('#deliverable_assignment_id').html('');
      }
    });
  });
<% end %>