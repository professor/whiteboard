<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>Class: User</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/user.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-find_for_google_apps_oauth">::find_for_google_apps_oauth</a>
    
    <li><a href="#method-c-new_with_session">::new_with_session</a>
    
    <li><a href="#method-c-parse_twiki">::parse_twiki</a>
    
    <li><a href="#method-i-create_google_email">#create_google_email</a>
    
    <li><a href="#method-i-create_twiki_account">#create_twiki_account</a>
    
    <li><a href="#method-i-create_yammer_account">#create_yammer_account</a>
    
    <li><a href="#method-i-emailed_recently">#emailed_recently</a>
    
    <li><a href="#method-i-faculty_teams_map">#faculty_teams_map</a>
    
    <li><a href="#method-i-find_teams_by_semester">#find_teams_by_semester</a>
    
    <li><a href="#method-i-formatted_teams">#formatted_teams</a>
    
    <li><a href="#method-i-initialize_human_name">#initialize_human_name</a>
    
    <li><a href="#method-i-notify_about_missing_field">#notify_about_missing_field</a>
    
    <li><a href="#method-i-past_teams">#past_teams</a>
    
    <li><a href="#method-i-permission_level_of">#permission_level_of</a>
    
    <li><a href="#method-i-person_before_save">#person_before_save</a>
    
    <li><a href="#method-i-registered_for_these_courses_during_current_semester">#registered_for_these_courses_during_current_semester</a>
    
    <li><a href="#method-i-reset_twiki_password">#reset_twiki_password</a>
    
    <li><a href="#method-i-teaching_these_courses_during_current_semester">#teaching_these_courses_during_current_semester</a>
    
    <li><a href="#method-i-telephones">#telephones</a>
    
    <li><a href="#method-i-telephones_hash">#telephones_hash</a>
    
    <li><a href="#method-i-update_webiso_account">#update_webiso_account</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./GAppsProvisioning.html">GAppsProvisioning</a>
  
    <li><a href="./GAppsProvisioning/Connection.html">GAppsProvisioning::Connection</a>
  
    <li><a href="./GAppsProvisioning/GDataError.html">GAppsProvisioning::GDataError</a>
  
    <li><a href="./GAppsProvisioning/GroupEntry.html">GAppsProvisioning::GroupEntry</a>
  
    <li><a href="./GAppsProvisioning/MemberEntry.html">GAppsProvisioning::MemberEntry</a>
  
    <li><a href="./GAppsProvisioning/NicknameEntry.html">GAppsProvisioning::NicknameEntry</a>
  
    <li><a href="./GAppsProvisioning/OwnerEntry.html">GAppsProvisioning::OwnerEntry</a>
  
    <li><a href="./GAppsProvisioning/ProvisioningApi.html">GAppsProvisioning::ProvisioningApi</a>
  
    <li><a href="./GAppsProvisioning/UserEntry.html">GAppsProvisioning::UserEntry</a>
  
    <li><a href="./EffortReportsController.html">EffortReportsController</a>
  
    <li><a href="./EffortReportsController/PanelState.html">EffortReportsController::PanelState</a>
  
    <li><a href="./EffortReportsController/SemesterPanel.html">EffortReportsController::SemesterPanel</a>
  
    <li><a href="./TimeMachine.html">TimeMachine</a>
  
    <li><a href="./TimeMachine/Date.html">TimeMachine::Date</a>
  
    <li><a href="./TimeMachine/Time.html">TimeMachine::Time</a>
  
    <li><a href="./PeopleController.html">PeopleController</a>
  
    <li><a href="./PeopleController/ClassProfileState.html">PeopleController::ClassProfileState</a>
  
    <li><a href="./Rails.html">Rails</a>
  
    <li><a href="./Rails/GemDependency.html">Rails::GemDependency</a>
  
    <li><a href="./Users.html">Users</a>
  
    <li><a href="./Users/OmniauthCallbacksController.html">Users::OmniauthCallbacksController</a>
  
    <li><a href="./Ability.html">Ability</a>
  
    <li><a href="./AcademicCalendar.html">AcademicCalendar</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Course.html">Course</a>
  
    <li><a href="./CourseMailer.html">CourseMailer</a>
  
    <li><a href="./CourseNavigationsController.html">CourseNavigationsController</a>
  
    <li><a href="./CourseNumber.html">CourseNumber</a>
  
    <li><a href="./CourseNumbersController.html">CourseNumbersController</a>
  
    <li><a href="./CourseNumbersHelper.html">CourseNumbersHelper</a>
  
    <li><a href="./CoursesController.html">CoursesController</a>
  
    <li><a href="./CoursesHelper.html">CoursesHelper</a>
  
    <li><a href="./DelayedSystemJob.html">DelayedSystemJob</a>
  
    <li><a href="./DelayedSystemJobsController.html">DelayedSystemJobsController</a>
  
    <li><a href="./Deliverable.html">Deliverable</a>
  
    <li><a href="./DeliverableAttachment.html">DeliverableAttachment</a>
  
    <li><a href="./DeliverablesController.html">DeliverablesController</a>
  
    <li><a href="./DeliverablesHelper.html">DeliverablesHelper</a>
  
    <li><a href="./EffortLog.html">EffortLog</a>
  
    <li><a href="./EffortLogLineItem.html">EffortLogLineItem</a>
  
    <li><a href="./EffortLogLineItemsController.html">EffortLogLineItemsController</a>
  
    <li><a href="./EffortLogLineItemsHelper.html">EffortLogLineItemsHelper</a>
  
    <li><a href="./EffortLogMailer.html">EffortLogMailer</a>
  
    <li><a href="./EffortLogsController.html">EffortLogsController</a>
  
    <li><a href="./EffortLogsHelper.html">EffortLogsHelper</a>
  
    <li><a href="./FacultyAssignment.html">FacultyAssignment</a>
  
    <li><a href="./Gem.html">Gem</a>
  
    <li><a href="./GenericAjaxController.html">GenericAjaxController</a>
  
    <li><a href="./GenericMailer.html">GenericMailer</a>
  
    <li><a href="./GoogleMailingListJob.html">GoogleMailingListJob</a>
  
    <li><a href="./HUBClassRosterHandler.html">HUBClassRosterHandler</a>
  
    <li><a href="./IndexTank.html">IndexTank</a>
  
    <li><a href="./MailingListsController.html">MailingListsController</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Page.html">Page</a>
  
    <li><a href="./PageAttachment.html">PageAttachment</a>
  
    <li><a href="./PageAttachmentsController.html">PageAttachmentsController</a>
  
    <li><a href="./PageComment.html">PageComment</a>
  
    <li><a href="./PageCommentMailer.html">PageCommentMailer</a>
  
    <li><a href="./PageCommentType.html">PageCommentType</a>
  
    <li><a href="./PageCommentTypesController.html">PageCommentTypesController</a>
  
    <li><a href="./PageCommentTypesHelper.html">PageCommentTypesHelper</a>
  
    <li><a href="./PageCommentsHelper.html">PageCommentsHelper</a>
  
    <li><a href="./PagesController.html">PagesController</a>
  
    <li><a href="./PagesHelper.html">PagesHelper</a>
  
    <li><a href="./PeerEvaluationController.html">PeerEvaluationController</a>
  
    <li><a href="./PeerEvaluationLearningObjective.html">PeerEvaluationLearningObjective</a>
  
    <li><a href="./PeerEvaluationReport.html">PeerEvaluationReport</a>
  
    <li><a href="./PeerEvaluationReview.html">PeerEvaluationReview</a>
  
    <li><a href="./PeopleHelper.html">PeopleHelper</a>
  
    <li><a href="./Person.html">Person</a>
  
    <li><a href="./PersonJob.html">PersonJob</a>
  
    <li><a href="./PersonMailer.html">PersonMailer</a>
  
    <li><a href="./Presentation.html">Presentation</a>
  
    <li><a href="./PresentationFeedback.html">PresentationFeedback</a>
  
    <li><a href="./PresentationFeedbackAnswer.html">PresentationFeedbackAnswer</a>
  
    <li><a href="./PresentationQuestion.html">PresentationQuestion</a>
  
    <li><a href="./PresentationsController.html">PresentationsController</a>
  
    <li><a href="./PresentationsHelper.html">PresentationsHelper</a>
  
    <li><a href="./RegisteredCourse.html">RegisteredCourse</a>
  
    <li><a href="./Registration.html">Registration</a>
  
    <li><a href="./RssFeed.html">RssFeed</a>
  
    <li><a href="./RssFeedsController.html">RssFeedsController</a>
  
    <li><a href="./RssFeedsHelper.html">RssFeedsHelper</a>
  
    <li><a href="./ScottyDogSaying.html">ScottyDogSaying</a>
  
    <li><a href="./ScottyDogSayingsController.html">ScottyDogSayingsController</a>
  
    <li><a href="./ScottyDogSayingsHelper.html">ScottyDogSayingsHelper</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SponsoredProject.html">SponsoredProject</a>
  
    <li><a href="./SponsoredProjectAllocation.html">SponsoredProjectAllocation</a>
  
    <li><a href="./SponsoredProjectAllocationsController.html">SponsoredProjectAllocationsController</a>
  
    <li><a href="./SponsoredProjectEffort.html">SponsoredProjectEffort</a>
  
    <li><a href="./SponsoredProjectEffortMailer.html">SponsoredProjectEffortMailer</a>
  
    <li><a href="./SponsoredProjectEffortsController.html">SponsoredProjectEffortsController</a>
  
    <li><a href="./SponsoredProjectSponsor.html">SponsoredProjectSponsor</a>
  
    <li><a href="./SponsoredProjectSponsorsController.html">SponsoredProjectSponsorsController</a>
  
    <li><a href="./SponsoredProjectsController.html">SponsoredProjectsController</a>
  
    <li><a href="./StaticController.html">StaticController</a>
  
    <li><a href="./StrengthTheme.html">StrengthTheme</a>
  
    <li><a href="./Suggestion.html">Suggestion</a>
  
    <li><a href="./SuggestionsController.html">SuggestionsController</a>
  
    <li><a href="./SystemController.html">SystemController</a>
  
    <li><a href="./SystemHelper.html">SystemHelper</a>
  
    <li><a href="./TaskType.html">TaskType</a>
  
    <li><a href="./TaskTypesController.html">TaskTypesController</a>
  
    <li><a href="./TaskTypesHelper.html">TaskTypesHelper</a>
  
    <li><a href="./Team.html">Team</a>
  
    <li><a href="./TeamAssignment.html">TeamAssignment</a>
  
    <li><a href="./TeamsController.html">TeamsController</a>
  
    <li><a href="./TeamsHelper.html">TeamsHelper</a>
  
    <li><a href="./TmpUpdateFacultyAssignments.html">TmpUpdateFacultyAssignments</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserPreference.html">UserPreference</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WelcomeController.html">WelcomeController</a>
  
    <li><a href="./WelcomeHelper.html">WelcomeHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class User</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="LoginName">LoginName
        
        <dd class="description">
        
      
        <dt id="Twk0Confirm">Twk0Confirm
        
        <dd class="description">
        
      
        <dt id="Twk0Password">Twk0Password
        
        <dd class="description">
        
      
        <dt id="Twk1Country">Twk1Country
        
        <dd class="description">
        
      
        <dt id="Twk1Email">Twk1Email
        
        <dd class="description">
        
      
        <dt id="Twk1FirstName">Twk1FirstName
        
        <dd class="description">
        
      
        <dt id="Twk1LastName">Twk1LastName
        
        <dd class="description">
        
      
        <dt id="Twk1WikiName">Twk1WikiName
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-find_for_google_apps_oauth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_for_google_apps_oauth</span><span
            class="method-args">(access_token, signed_in_resource=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_for_google_apps_oauth-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_for_google_apps_oauth</span>(<span class="ruby-identifier">access_token</span>, <span class="ruby-identifier">signed_in_resource</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">access_token</span>[<span class="ruby-string">'user_info'</span>]
  <span class="ruby-identifier">email</span> = <span class="ruby-identifier">switch_west_to_sv</span>(<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;email&quot;</span>]).<span class="ruby-identifier">downcase</span>
  <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">email</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_for_google_apps_oauth-source -->
          
        </div>

        

        
      </div><!-- find_for_google_apps_oauth-method -->

    
      <div id="method-c-new_with_session" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_with_session</span><span
            class="method-args">(params, session)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new_with_session-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 77</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_with_session</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">session</span>)
  <span class="ruby-keyword">super</span>.<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> = <span class="ruby-identifier">session</span>[<span class="ruby-string">&quot;devise.google_apps_data&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">session</span>[<span class="ruby-string">&quot;devise.google_apps_data&quot;</span>][<span class="ruby-string">&quot;extra&quot;</span>][<span class="ruby-string">&quot;user_hash&quot;</span>]
      <span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;email&quot;</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new_with_session-source -->
          
        </div>

        

        
      </div><!-- new_with_session-method -->

    
      <div id="method-c-parse_twiki" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_twiki</span><span
            class="method-args">(username)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="parse_twiki-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse_twiki</span>(<span class="ruby-identifier">username</span>)
  <span class="ruby-comment"># The regular expression matches on twiki usernames. Ie AliceSmithJones returns the array [&quot;Alice&quot;, &quot;SmithJones&quot;]</span>
  <span class="ruby-comment"># This does not work with numbers or characters in the firstname field</span>
  <span class="ruby-comment"># http://rubular.com/</span>
  <span class="ruby-identifier">match</span> = <span class="ruby-identifier">username</span>.<span class="ruby-identifier">match</span> <span class="ruby-regexp">/([A-Z][a-z]*)([A-Z][\w]*)/</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">match</span>[<span class="ruby-value">2</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parse_twiki-source -->
          
        </div>

        

        
      </div><!-- parse_twiki-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-create_google_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_google_email</span><span
            class="method-args">(password)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Creates a Google Apps for University account for the user. For legacy
reasons, the accounts are with the domain west.cmu.edu even though the
preferred way of talking about the account is with the domain sv.cmu.edu</p>

<p>Input is a password If this fails, it returns an error message as a string</p>
          

          
          <div class="method-source-code" id="create_google_email-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_google_email</span>(<span class="ruby-identifier">password</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Empty email address&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Attempting to create google email account for &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>)
  (<span class="ruby-identifier">username</span>, <span class="ruby-identifier">domain</span>) = <span class="ruby-identifier">switch_sv_to_west</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">'@'</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">domain</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">GOOGLE_DOMAIN</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Domain (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">domain</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;) is not the same as the google domain (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">GOOGLE_DOMAIN</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Domain (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">domain</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;) is not the same as the google domain (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">GOOGLE_DOMAIN</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">user</span> = <span class="ruby-identifier">google_apps_connection</span>.<span class="ruby-identifier">create_user</span>(<span class="ruby-identifier">username</span>,
                                              <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_name</span>,
                                              <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_name</span>,
                                              <span class="ruby-identifier">password</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">GDataError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment">#error code : 1300, invalid input : Andrew.Carngie, reason : EntityExists</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">pretty_print_google_error</span>(<span class="ruby-identifier">e</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">google_created</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">user</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_google_email-source -->
          
        </div>

        

        
      </div><!-- create_google_email-method -->

    
      <div id="method-i-create_twiki_account" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_twiki_account</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Creates a twiki account for the user</p>

<p>You may need to modify mechanize as seen here <a
href="http://github.com/eric/mechanize/commit/7fd877c60cbb3855652c390c980df1dedfaed820">github.com/eric/mechanize/commit/7fd877c60cbb3855652c390c980df1dedfaed820</a></p>
          

          
          <div class="method-source-code" id="create_twiki_account-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 231</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_twiki_account</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'mechanize'</span>
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">basic_auth</span>(<span class="ruby-constant">TWIKI_USERNAME</span>, <span class="ruby-constant">TWIKI_PASSWORD</span>)
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">TWIKI_URL</span> <span class="ruby-operator">+</span> <span class="ruby-string">'/do/view/TWiki/TWikiRegistration'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">registration_result</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">form_with</span>(<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/do/register/Main/WebHome'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">registration</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk1FirstName</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_name</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk1LastName</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_name</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk1WikiName</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">twiki_name</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk1Email</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk0Password</span> = <span class="ruby-string">'just4now'</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk0Confirm</span> = <span class="ruby-string">'just4now'</span>
      <span class="ruby-identifier">registration</span>.<span class="ruby-constant">Twk1Country</span> = <span class="ruby-string">'USA'</span>
      <span class="ruby-comment">#      registration.action = 'register'</span>
      <span class="ruby-comment">#      registration.topic = 'TWikiRegistration'</span>
      <span class="ruby-comment">#      registration.rx = '%BLACKLISTPLUGIN{ action=\&quot;magic\&quot; }%'</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">submit</span>
    <span class="ruby-comment">#   #&lt;WWW::Mechanize::Page::Link &quot;AndrewCarnegie&quot; &quot;/do/view/Main/AndrewCarnegie&quot;&gt;</span>
    <span class="ruby-identifier">link</span> = <span class="ruby-identifier">registration_result</span>.<span class="ruby-identifier">link_with</span>(<span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">twiki_name</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#the user probably already exists</span>
      <span class="ruby-identifier">pp</span> <span class="ruby-identifier">registration_result</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">twiki_created</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


<span class="ruby-keyword">end</span></pre>
          </div><!-- create_twiki_account-source -->
          
        </div>

        

        
      </div><!-- create_twiki_account-method -->

    
      <div id="method-i-create_yammer_account" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_yammer_account</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_yammer_account-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_yammer_account</span>
  <span class="ruby-comment">#See lib/yammer.rb for code that would create the user account.</span>
  <span class="ruby-comment">#We can't use the yammer API until we upgrade the service</span>

  <span class="ruby-comment">#The most simple way here is to invite the user to register</span>
  <span class="ruby-comment">#Note that yammer requires https://www.yammer.com/</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'mechanize'</span>
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">'https://www.yammer.com/'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">result_page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">form_with</span>(<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/users'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">invite_page</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">invite_page</span>[<span class="ruby-string">'user[email]'</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">submit</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">yammer_created</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_yammer_account-source -->
          
        </div>

        

        
      </div><!-- create_yammer_account-method -->

    
      <div id="method-i-emailed_recently" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emailed_recently</span><span
            class="method-args">(email_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="emailed_recently-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emailed_recently</span>(<span class="ruby-identifier">email_type</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">email_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:effort_log</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">effort_log_warning_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">effort_log_warning_email</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span>.<span class="ruby-identifier">ago</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:sponsored_project_effort</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sponsored_project_effort_last_emailed</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">sponsored_project_effort_last_emailed</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span>.<span class="ruby-identifier">ago</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emailed_recently-source -->
          
        </div>

        

        
      </div><!-- emailed_recently-method -->

    
      <div id="method-i-faculty_teams_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">faculty_teams_map</span><span
            class="method-args">(person_id = self.id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This method contributed by <a href="Team.html">Team</a> Juran</p>
          

          
          <div class="method-source-code" id="faculty_teams_map-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">faculty_teams_map</span>(<span class="ruby-identifier">person_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">faculty_teams</span> = <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-string">&quot;SELECT t.* FROM  teams t WHERE t.primary_faculty_id = ? OR t.secondary_faculty_id = ?&quot;</span>, <span class="ruby-identifier">person_id</span>, <span class="ruby-identifier">person_id</span>])

  <span class="ruby-identifier">teams_map</span> = {}
  <span class="ruby-identifier">teams_students_map</span> = {}
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">team</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">faculty_teams</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">teams_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">teams_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>] = {}
      <span class="ruby-identifier">teams_students_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>] = {}
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">teams_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>][<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span>.<span class="ruby-identifier">downcase</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">teams_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>][<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span>.<span class="ruby-identifier">downcase</span>] = []
      <span class="ruby-identifier">teams_students_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>][<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span>.<span class="ruby-identifier">downcase</span>] = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">teams_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>][<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span>.<span class="ruby-identifier">downcase</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">team</span>)
    <span class="ruby-identifier">teams_students_map</span>[<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span>][<span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span>.<span class="ruby-identifier">downcase</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">members</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># teams_map is a two dimentional hash holding arrays of courses</span>
  <span class="ruby-comment"># teams_students_map is a two dimentional hash holding an integer count</span>
  <span class="ruby-comment"># of students that are part of the courses for a given semester</span>
  <span class="ruby-keyword">return</span> [<span class="ruby-identifier">teams_map</span>, <span class="ruby-identifier">teams_students_map</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- faculty_teams_map-source -->
          
        </div>

        

        
      </div><!-- faculty_teams_map-method -->

    
      <div id="method-i-find_teams_by_semester" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_teams_by_semester</span><span
            class="method-args">(year, semester)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_teams_by_semester-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_teams_by_semester</span>(<span class="ruby-identifier">year</span>, <span class="ruby-identifier">semester</span>)
  <span class="ruby-identifier">s_teams</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">teams</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">team</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s_teams</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">team</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">year</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">semester</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">semester</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">s_teams</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_teams_by_semester-source -->
          
        </div>

        

        
      </div><!-- find_teams_by_semester-method -->

    
      <div id="method-i-formatted_teams" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">formatted_teams</span><span
            class="method-args">(array)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given an array of team objects [Awesome, Devils, Alpha Omega] Returns
“Awesome, Devils, Alpha Omega”</p>
          

          
          <div class="method-source-code" id="formatted_teams-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">formatted_teams</span>(<span class="ruby-identifier">array</span>)
  <span class="ruby-identifier">array</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">team</span><span class="ruby-operator">|</span> <span class="ruby-identifier">team</span>.<span class="ruby-identifier">name</span> } * <span class="ruby-string">&quot;, &quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- formatted_teams-source -->
          
        </div>

        

        
      </div><!-- formatted_teams-method -->

    
      <div id="method-i-initialize_human_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">initialize_human_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="initialize_human_name-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize_human_name</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">human_name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_name</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">human_name</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- initialize_human_name-source -->
          
        </div>

        

        
      </div><!-- initialize_human_name-method -->

    
      <div id="method-i-notify_about_missing_field" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">notify_about_missing_field</span><span
            class="method-args">(attribute, message)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>attribute :github If the user has not set this attribute, then ask the user
to do so</p>
          

          
          <div class="method-source-code" id="notify_about_missing_field-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_about_missing_field</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">message</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">attribute</span>).<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">options</span> = {<span class="ruby-value">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>,
               <span class="ruby-value">:subject</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Your user account needs updating&quot;</span>,
               <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">message</span>,
               <span class="ruby-value">:url_label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Modify your profile&quot;</span>,
               <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">routes</span>.<span class="ruby-identifier">url_helpers</span>.<span class="ruby-identifier">edit_user_url</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;rails.sv.cmu.edu&quot;</span>)
    }
    <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">email</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- notify_about_missing_field-source -->
          
        </div>

        

        
      </div><!-- notify_about_missing_field-method -->

    
      <div id="method-i-past_teams" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">past_teams</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Todo: This method looks similiar to one in helpers/teams_helper.rb – if so
DRY!</p>
          

          
          <div class="method-source-code" id="past_teams-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">past_teams</span>
  <span class="ruby-constant">Team</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-string">&quot;SELECT t.* FROM  teams t INNER JOIN team_assignments ta ON ( t.id = ta.team_id) INNER JOIN users u ON (ta.user_id = u.id) INNER JOIN courses c ON (t.course_id = c.id) WHERE u.id = ? AND (c.semester &lt;&gt; ? OR c.year &lt;&gt; ?)&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-constant">AcademicCalendar</span>.<span class="ruby-identifier">current_semester</span>(), <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">year</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- past_teams-source -->
          
        </div>

        

        
      </div><!-- past_teams-method -->

    
      <div id="method-i-permission_level_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">permission_level_of</span><span
            class="method-args">(role)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="permission_level_of-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">permission_level_of</span>(<span class="ruby-identifier">role</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">role</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:student</span>
      <span class="ruby-keyword">return</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_student?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_staff?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_admin?</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-value">:staff</span>
      <span class="ruby-keyword">return</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_staff?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_admin?</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-value">:admin</span>
      <span class="ruby-keyword">return</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_admin?</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- permission_level_of-source -->
          
        </div>

        

        
      </div><!-- permission_level_of-method -->

    
      <div id="method-i-registered_for_these_courses_during_current_semester" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">registered_for_these_courses_during_current_semester</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="registered_for_these_courses_during_current_semester-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">registered_for_these_courses_during_current_semester</span>
  <span class="ruby-identifier">hub_registered_courses</span> = <span class="ruby-identifier">registered_courses</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:semester</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AcademicCalendar</span>.<span class="ruby-identifier">current_semester</span>, <span class="ruby-value">:year</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">year</span>).<span class="ruby-identifier">all</span>

  <span class="ruby-identifier">sql_str</span> = <span class="ruby-node">&quot;select c.* FROM courses c,teams t
            where t.course_id=c.id and c.year=#{Date.today.year} and c.semester='#{AcademicCalendar.current_semester()}' and t.id in
            (SELECT ta.team_id FROM team_assignments ta, users u where u.id=ta.user_id and u.id=#{self.id})&quot;</span>
  <span class="ruby-identifier">courses_assigned_on_teams</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql_str</span>)

  <span class="ruby-ivar">@registered_courses</span> = <span class="ruby-identifier">hub_registered_courses</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">courses_assigned_on_teams</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- registered_for_these_courses_during_current_semester-source -->
          
        </div>

        

        
      </div><!-- registered_for_these_courses_during_current_semester-method -->

    
      <div id="method-i-reset_twiki_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_twiki_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="reset_twiki_password-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_twiki_password</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'mechanize'</span>
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">basic_auth</span>(<span class="ruby-constant">TWIKI_USERNAME</span>, <span class="ruby-constant">TWIKI_PASSWORD</span>)
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">TWIKI_URL</span> <span class="ruby-operator">+</span> <span class="ruby-string">'/do/view/TWiki/ResetPassword'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">reset_result_page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">form_with</span>(<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/do/resetpasswd/Main/WebHome'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reset_page</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">reset_page</span>.<span class="ruby-constant">LoginName</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">twiki_name</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">submit</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset_result_page</span>.<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">'.patternTopic h3'</span>).<span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot; Password reset failed &quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset_result_page</span>.<span class="ruby-identifier">link_with</span>(<span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'change password'</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_twiki_password-source -->
          
        </div>

        

        
      </div><!-- reset_twiki_password-method -->

    
      <div id="method-i-teaching_these_courses_during_current_semester" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">teaching_these_courses_during_current_semester</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="teaching_these_courses_during_current_semester-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">teaching_these_courses_during_current_semester</span>
  <span class="ruby-identifier">teaching_these_courses</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:semester</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AcademicCalendar</span>.<span class="ruby-identifier">current_semester</span>, <span class="ruby-value">:year</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">year</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- teaching_these_courses_during_current_semester-source -->
          
        </div>

        

        
      </div><!-- teaching_these_courses_during_current_semester-method -->

    
      <div id="method-i-telephones" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">telephones</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="telephones-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">telephones</span>
  <span class="ruby-identifier">phones</span> = []
  <span class="ruby-identifier">phones</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{self.telephone1_label}: #{self.telephone1}&quot;</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{self.telephone2_label}: #{self.telephone2}&quot;</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{self.telephone3_label}: #{self.telephone3}&quot;</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{self.telephone4_label}: #{self.telephone4}&quot;</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">phones</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- telephones-source -->
          
        </div>

        

        
      </div><!-- telephones-method -->

    
      <div id="method-i-telephones_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">telephones_hash</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="telephones_hash-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">telephones_hash</span>
  <span class="ruby-identifier">phones</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">phones</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1_label</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone1_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2_label</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone2_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3_label</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone3_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-identifier">phones</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4_label</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4</span> <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4_label</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">telephone4_label</span>.<span class="ruby-identifier">empty?</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">phones</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- telephones_hash-source -->
          
        </div>

        

        
      </div><!-- telephones_hash-method -->

    
      <div id="method-i-update_webiso_account" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_webiso_account</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_webiso_account-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_webiso_account</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">webiso_account</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">webiso_account</span>.<span class="ruby-identifier">blank?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_webiso_account-source -->
          
        </div>

        

        
      </div><!-- update_webiso_account-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-person_before_save" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">person_before_save</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="person_before_save-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 333</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">person_before_save</span>
  <span class="ruby-comment"># We populate some reasonable defaults, but this can be overridden in the database</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">human_name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_name</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">human_name</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;@sv.cmu.edu&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>.<span class="ruby-identifier">blank?</span>

  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;self.photo.blank? #{self.photo.blank?}&quot;</span>)
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;photo.url #{photo.url}&quot;</span>)
  <span class="ruby-comment"># update the image_uri if a photo was uploaded</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">image_uri</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:profile</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">'?'</span>)[<span class="ruby-value">0</span>] <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">url</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/photos/original/missing.png&quot;</span>)

<span class="ruby-keyword">end</span></pre>
          </div><!-- person_before_save-source -->
          
        </div>

        

        
      </div><!-- person_before_save-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.10.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

